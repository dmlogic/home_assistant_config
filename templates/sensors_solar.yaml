- sensor:
  - name: "Power - Battery Charging"
    unit_of_measurement: "W"
    state: "{{ max([states('sensor.solaredge_battery1_power') | float(0), 0]) | abs() }}"
  - name: "Power - Battery Discharging"
    unit_of_measurement: "W"
    state: "{{ min([states('sensor.solaredge_battery1_power') | float(0), 0]) | abs() }}"
  - name: "Power - Battery Charging from AC"
    unit_of_measurement: "W"
    state: "{{ min([states('sensor.solaredge_ac_power') | float(0), 0]) | abs() }}"
  - name: "Power - Battery Charging from Solar"
    unit_of_measurement: "W"
    state: "{{ (states('sensor.power_battery_charging') | float(0)) - (states('sensor.power_battery_charging_ac') | float(0)) }}"
  - name: "Power - Grid Import"
    unit_of_measurement: "W"
    state: "{{ (min([states('sensor.solaredge_m1_ac_power') | float(0), 0]) | abs()) - (states('sensor.power_battery_charging_ac') | float(0)) }}"
  - name: "Power - Grid Export"
    unit_of_measurement: "W"
    state: "{{ max([states('sensor.solaredge_m1_ac_power') | float(0), 0]) | abs() }}"
  - name: "Power - Solar Generation"
    unit_of_measurement: "W"
    state: "{{ max([states('sensor.solaredge_ac_power') | float(0), 0]) + (states('sensor.power_battery_charging_solar') | float(0)) - (states('sensor.power_battery_discharging') | float(0)) }}"
  - name: "Power - Consumption"
    unit_of_measurement: "W"
    state: "{{ max([states('sensor.solaredge_ac_power') | float(0), 0]) - states('sensor.solaredge_m1_ac_power') | float(0) }}"
  - name: "Power - Self Consumption"
    unit_of_measurement: "W"
    state: "{{ max([states('sensor.solaredge_ac_power') | float(0), 0]) - (states('sensor.power_battery_discharging') | float(0)) - states('sensor.power_grid_export') | float(0) }}"
  - name: "Energy - Solar Generation"
    unit_of_measurement: "kWh"
    state: "{{ (states('sensor.solaredge_ac_energy_kwh') | float(0)) - (states('sensor.energy_battery_discharged') | float(0)) + (states('sensor.energy_battery_charged_solar') | float(0)) }}"
